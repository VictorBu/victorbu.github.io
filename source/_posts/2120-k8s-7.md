---
title: k8s (七) 从应用访问 pod 元数据以及其他资源
date: 2021-01-25 12:00:00
updated: 2021-01-25 12:00:00
categories: [IT]
tags: [Kubernetes]
---

Downward API 可以给在 pod 中运行的进程暴露 pod 的元数据。目前我们可以给容器传递以下数据：
+ pod 的名称
+ pod 的 IP
+ pod 所在的命名空间
+ pod 运行节点的名称
+ pod 运行所归属的服务账户的名称
+ 每个容器请求的 CPU 和内存的使用量
+ 每个容器可以使用的 CPU 和内存的限制
+ pod 的标签
+ pod 的注解

# 一、通过环境变量暴露元数据

```
# downward-api-env.yaml

apiVersion: v1
kind: Pod
metadata:
  name: downward
spec:
  containers:
  - name: main
    image: busybox
    command: ["sleep", "9999999"]
    resources:
      requests:
        cpu: 15m
        memory: 100Ki
      limits:
        cpu: 100m
        memory: 4Mi
    env:
    - name: POD_NAME
      valueFrom:
        fieldRef:
          fieldPath: metadata.name # 引用 pod manifest 中的元数据名称字段，而不是设定一个具体的值
    - name: POD_NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
    - name: POD_IP
      valueFrom:
        fieldRef:
          fieldPath: status.podIP
    - name: NODE_NAME
      valueFrom:
        fieldRef:
          fieldPath: spec.nodeName
    - name: SERVICE_ACCOUNT
      valueFrom:
        fieldRef:
          fieldPath: spec.serviceAccountName
    - name: CONTAINER_CPU_REQUEST_MILLICORES
      valueFrom:
        resourceFieldRef:
          resource: requests.cpu
          divisor: 1m
    - name: CONTAINER_MEMORY_LIMIT_KIBIBYTES
      valueFrom:
        resourceFieldRef:
          resource: limits.memory
          divisor: 1Ki
```

```kubectl create -f downward-api-env.yaml```

# 二、通过 downwardAPI 卷来传递元数据

暂略。。
