---
title: k8s (九) StatefulSet: 部署有状态的多副本应用
date: 2021-01-28 12:00:00
updated: 2021-01-28 12:00:00
categories: [IT]
tags: [Kubernetes]
---

RelicaSet 或 ReplicationController 管理的 pod 副本都是无状态的，任何时候它们都可以被一个全新的 pod 替换。然而有状态的 pod 需要不同的方法，当一个有状态的 pod 挂掉后（或者它所在的节点故障），这个 pod 实例需要在别的节点上重建，但是新的实例必须与被替换的实例拥有相同的名称、网络标识和状态，这就需要使用 StatefulSet。

一个 StatefulSet 创建的每个 pod 都有一个从零开始的顺序索引，这个会体现在 pod 的名称和主机名上，同样还会体现在 pod 对应的固定存储上。这些 pod 的名称则是可预知的，因为它是由 StatefulSet 的名称加该实例的顺序索引值组成的。

扩容一个 StatefulSet 会使用下一个还没用到的顺序索引值创建一个新的 pod 实例。比如，要把一个 StatefulSet 从两个实例扩容到三个实例，那么新实例的索引值就会是 2 (现有实例使用的索引值为0和1)。缩容一个 StatefulSet 将会最先删除最高索引值的实例，所以缩容的结果是可预知的。

# 一、使用 StatefulSet

暂略。。